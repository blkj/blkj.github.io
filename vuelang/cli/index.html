<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件开发指南 | 坑王的爬坑悲惨世界</title>
    <meta name="description" content="人生就是爬坑挣扎史">
    
    
    <link rel="preload" href="/assets/css/0.styles.9d3ff1b1.css" as="style"><link rel="preload" href="/assets/js/app.9374f4fe.js" as="script"><link rel="preload" href="/assets/js/3.6325cee0.js" as="script"><link rel="preload" href="/assets/js/2.3daf7506.js" as="script"><link rel="preload" href="/assets/js/9.78e37e51.js" as="script"><link rel="prefetch" href="/assets/js/10.2fb07242.js"><link rel="prefetch" href="/assets/js/11.93868612.js"><link rel="prefetch" href="/assets/js/12.80742047.js"><link rel="prefetch" href="/assets/js/13.939efcb0.js"><link rel="prefetch" href="/assets/js/4.e212f005.js"><link rel="prefetch" href="/assets/js/5.f6dc21a3.js"><link rel="prefetch" href="/assets/js/6.744ad950.js"><link rel="prefetch" href="/assets/js/7.870832c5.js"><link rel="prefetch" href="/assets/js/8.4e21152f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9d3ff1b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">坑王的爬坑悲惨世界</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuelang/sixiang/" class="nav-link">vue思想</a></li><li class="dropdown-item"><!----> <a href="/vuelang/cli/" class="nav-link router-link-exact-active router-link-active">vue-cli</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueblog/suosi/" class="nav-link">日有所思</a></li><li class="dropdown-item"><!----> <a href="/vueblog/suomeng/" class="nav-link">夜有所梦</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueui/haohao/" class="nav-link">好好学习</a></li><li class="dropdown-item"><!----> <a href="/vueui/tiantian/" class="nav-link">天天向上</a></li></ul></div></div> <a href="https://github.com/blkj/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuelang/sixiang/" class="nav-link">vue思想</a></li><li class="dropdown-item"><!----> <a href="/vuelang/cli/" class="nav-link router-link-exact-active router-link-active">vue-cli</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueblog/suosi/" class="nav-link">日有所思</a></li><li class="dropdown-item"><!----> <a href="/vueblog/suomeng/" class="nav-link">夜有所梦</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vueui/haohao/" class="nav-link">好好学习</a></li><li class="dropdown-item"><!----> <a href="/vueui/tiantian/" class="nav-link">天天向上</a></li></ul></div></div> <a href="https://github.com/blkj/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>插件开发指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuelang/cli/#核心概念" class="sidebar-link"># 核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuelang/cli/#creator" class="sidebar-link"># Creator</a></li><li class="sidebar-sub-header"><a href="/vuelang/cli/#service" class="sidebar-link"># Service</a></li><li class="sidebar-sub-header"><a href="/vuelang/cli/#cli-插件" class="sidebar-link"># CLI 插件</a></li><li class="sidebar-sub-header"><a href="/vuelang/cli/#service-插件" class="sidebar-link"># Service 插件</a></li><li class="sidebar-sub-header"><a href="/vuelang/cli/#generator" class="sidebar-link"># Generator</a></li><li class="sidebar-sub-header"><a href="/vuelang/cli/#prompts" class="sidebar-link"># Prompts</a></li></ul></li><li><a href="/vuelang/cli/#发布插件" class="sidebar-link"># 发布插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuelang/cli/#本地测试插件" class="sidebar-link"># 本地测试插件</a></li></ul></li><li><a href="/vuelang/cli/#开发核心插件的注意事项" class="sidebar-link"># 开发核心插件的注意事项</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="插件开发指南"><a href="#插件开发指南" aria-hidden="true" class="header-anchor">#</a> 插件开发指南</h1> <h2 id="核心概念"><a href="#核心概念" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 核心概念</h2> <p>系统里有两个主要的部分：</p> <ul><li><code>@vue/cli</code>：全局安装的，暴露 <code>vue create &lt;app&gt;</code> 命令；</li> <li><code>@vue/cli-service</code>：局部安装，暴露 <code>vue-cli-service</code> 命令。</li></ul> <p>两者皆应用了基于插件的架构。</p> <h3 id="creator"><a href="#creator" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#creator" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Creator</h3> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/Creator.js" target="_blank" rel="noopener noreferrer">Creator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/Creator.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>是调用 <code>vue create &lt;app&gt;</code> 时创建的类。负责偏好对话、调用 generator 和安装依赖。</p> <h3 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#service" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Service</h3> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/Service.js" target="_blank" rel="noopener noreferrer">Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/Service.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>是调用 <code>vue-cli-service &lt;command&gt; [...args]</code> 时创建的类。负责管理内部的 webpack 配置、暴露服务和构建项目的命令等。</p> <h3 id="cli-插件"><a href="#cli-插件" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#cli-%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> CLI 插件</h3> <p>CLI 插件是一个可以为 <code>@vue/cli</code> 项目添加额外特性的 npm 包。它应该始终包含一个 <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#service-%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">Service 插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>作为其主要导出，且可选的包含一个 <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#generator" target="_blank" rel="noopener noreferrer">Generator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和一个 <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D" target="_blank" rel="noopener noreferrer">Prompt 文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>一个典型的 CLI 插件的目录结构看起来是这样的：</p> <div class="language-text extra-class"><pre class="language-text"><code>.
├── README.md
├── generator.js  # generator (可选)
├── prompts.js    # prompt 文件 (可选)
├── index.js      # service 插件
└── package.json
</code></pre></div><h3 id="service-插件"><a href="#service-插件" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#service-%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Service 插件</h3> <p>Service 插件会在一个 Service 实例被创建时自动加载——比如每次 <code>vue-cli-service</code> 命令在项目中被调用时。</p> <p>注意我们这里讨论的“service 插件”的概念要比发布为一个 npm 包的“CLI 插件”的要更窄。前者涉及一个会被 <code>@vue/cli-service</code> 在初始化时加载的模块，也经常是后者的一部分。</p> <p>此外，<code>@vue/cli-service</code> 的<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/commands" target="_blank" rel="noopener noreferrer">内建命令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/commands" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/config" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>一个 service 插件应该导出一个函数，这个函数接受两个参数：</p> <ul><li>一个 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/PluginAPI.js" target="_blank" rel="noopener noreferrer">PluginAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/PluginAPI.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>实例</li> <li>一个包含 <code>vue.config.js</code> 内指定的项目本地选项的对象，或者在 <code>package.json</code> 内的 <code>vue</code> 字段。</li></ul> <p>这个 API 允许 service 插件针对不同的环境扩展/修改内部的 webpack 配置，并向 <code>vue-cli-service</code> 注入额外的命令。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过 webpack-chain 修改 webpack 配置</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  api<span class="token punctuation">.</span><span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改 webpack 配置</span>
    <span class="token comment">// 或返回通过 webpack-merge 合并的配置对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注册 `vue-cli-service test`</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="为命令指定模式"><a href="#为命令指定模式" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E4%B8%BA%E5%91%BD%E4%BB%A4%E6%8C%87%E5%AE%9A%E6%A8%A1%E5%BC%8F" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 为命令指定模式</h4> <blockquote><p>注意：插件设置模式的方式从 beta.10 开始已经改变了。</p></blockquote> <p>如果一个已注册的插件命令需要运行在特定的默认模式下，则该插件需要通过 <code>module.exports.defaultModes</code> 以 <code>{ [commandName]: mode }</code> 的形式来暴露：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>defaultModes <span class="token operator">=</span> <span class="token punctuation">{</span>
  build<span class="token punctuation">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是因为我们需要在加载环境变量之前知道该命令的预期模式，所以需要提前加载用户选项/应用插件。</p> <h4 id="在插件中解析-webpack-配置"><a href="#在插件中解析-webpack-配置" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E5%9C%A8%E6%8F%92%E4%BB%B6%E4%B8%AD%E8%A7%A3%E6%9E%90-webpack-%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 在插件中解析 webpack 配置</h4> <p>一个插件可以通过调用 <code>api.resolveWebpackConfig()</code> 取回解析好的 webpack 配置。每次调用都会新生成一个 webpack 配置用来在需要时进一步修改。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'my-build'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> configA <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> configB <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 针对不同的目的修改 `configA` 和 `configB`...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请确保为正确的环境变量指定默认模式</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>defaultModes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'my-build'</span><span class="token punctuation">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者，一个插件也可以通过调用 <code>api.resolveChainableWebpackConfig()</code> 获得一个新生成的<a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">链式配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>：</p> <div class="language-js extra-class"><pre class="language-js"><code>api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'my-build'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> configA <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveChainableWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> configB <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveChainableWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 针对不同的目的链式修改 `configA` 和 `configB`...</span>

  <span class="token keyword">const</span> finalConfigA <span class="token operator">=</span> configA<span class="token punctuation">.</span><span class="token function">toConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> finalConfigB <span class="token operator">=</span> configB<span class="token punctuation">.</span><span class="token function">toConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="第三方插件的自定义选项"><a href="#第三方插件的自定义选项" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%89%E9%A1%B9" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 第三方插件的自定义选项</h4> <p><code>vue.config.js</code> 的导出将会<a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/options.js#L3" target="_blank" rel="noopener noreferrer">通过一个 schema 的验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/options.js#L3" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>以避免笔误和错误的配置值。然而，一个第三方插件仍然允许用户通过 <code>pluginOptions</code> 字段配置其行为。例如，对于下面的 <code>vue.config.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  pluginOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该第三方插件可以读取 <code>projectOptions.pluginOptions.foo</code> 来做条件式的决定配置。</p> <h3 id="generator"><a href="#generator" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#generator" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Generator</h3> <p>一个发布为 npm 包的 CLI 插件可以包含一个 <code>generator.js</code> 或 <code>generator/index.js</code> 文件。插件内的 generator 将会在两种场景下被调用：</p> <ul><li>在一个项目的初始化创建过程中，如果 CLI 插件作为项目创建 preset 的一部分被安装。</li> <li>插件在项目创建好之后通过 <code>vue invoke</code> 独立调用时被安装。</li></ul> <p>这里的 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/GeneratorAPI.js" target="_blank" rel="noopener noreferrer">GeneratorAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/GeneratorAPI.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>允许一个 generator 向 <code>package.json</code> 注入额外的依赖或字段，并向项目中添加文件。</p> <p>一个 generator 应该导出一个函数，这个函数接收三个参数：</p> <ol><li><p>一个 <code>GeneratorAPI</code> 实例：</p></li> <li><p>这个插件的 generator 选项。这些选项会在项目创建对话过程中被解析，或从一个保存在 <code>~/.vuerc</code> 中的 preset 中加载。例如，如果保存好的 <code>~/.vuerc</code> 像如下的这样：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;@vue/cli-plugin-foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;option&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果用户使用 preset <code>foo</code> 创建了一个项目，那么 <code>@vue/cli-plugin-foo</code> 的 generator 就会收到 <code>{ option: 'bar' }</code> 作为第二个参数。</p> <p>对于一个第三方插件来说，该选项将会解析自对话或用户执行 <code>vue invoke</code> 时的命令行参数中 (详见<a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D" target="_blank" rel="noopener noreferrer">第三方插件的对话<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)。</p></li> <li><p>整个 preset (<code>presets.foo</code>) 将会作为第三个参数传入。</p></li></ol> <p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options<span class="token punctuation">,</span> rootOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改 `package.json` 里的字段</span>
  api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    scripts<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token string">'vue-cli-service test'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 复制并用 ejs 渲染 `./template` 内所有的文件</span>
  api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./template'</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有条件地生成文件</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="generator-的模板处理"><a href="#generator-的模板处理" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#generator-%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%A4%84%E7%90%86" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Generator 的模板处理</h4> <p>当你调用 <code>api.render('./template')</code> 时，该 generator 将会使用 <a href="https://github.com/mde/ejs" target="_blank" rel="noopener noreferrer">EJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/mde/ejs" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>渲染 <code>./template</code> 中的文件 (相对于 generator 中的文件路径进行解析)</p> <p>此外，你可以使用 YAML 前置元信息继承并替换已有的模板文件的一部分：</p> <div class="language-ejs extra-class"><pre class="language-ejs"><code>---
extend: '@vue/cli-service/generator/template/src/App.vue'
replace: !!js/regexp /<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">&lt;</span>\<span class="token regex">/script&gt;/</span>
<span class="token operator">--</span><span class="token operator">-</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 替换默认脚本</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>你也可以完成多处替换，当然你需要将要替换的字符串用 <code>&lt;%# REPLACE %&gt;</code> 和 <code>&lt;%# END_REPLACE %&gt;</code> 块包裹起来：</p> <div class="language-ejs extra-class"><pre class="language-ejs"><code>---
extend: '@vue/cli-service/generator/template/src/App.vue'
replace:
  - !!js/regexp /欢迎来到你的 Vue\.js 应用/
  - !!js/regexp /<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">&lt;</span>\<span class="token regex">/script&gt;/</span>
<span class="token operator">--</span><span class="token operator">-</span>

<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
替换欢迎信息
<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># END_REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>

<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 替换默认脚本</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># END_REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><h4 id="文件名的极端情况"><a href="#文件名的极端情况" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E6%96%87%E4%BB%B6%E5%90%8D%E7%9A%84%E6%9E%81%E7%AB%AF%E6%83%85%E5%86%B5" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文件名的极端情况</h4> <p>如果你想要渲染一个以点开头的模板文件 (例如 <code>.env</code>)，则需要遵循一个特殊的命名约定，因为以点开头的文件会在插件发布到 npm 的时候被忽略：</p> <div class="language-text extra-class"><pre class="language-text"><code># 以点开头的模板需要使用下划线取代那个点：

/generator/template/_env

# 调用 api.render('./template') 会在项目目录中渲染成为：

.env
</code></pre></div><p>同时这也意味着当你想渲染以下划线开头的文件时，同样需要遵循一个特殊的命名约定：</p> <div class="language-text extra-class"><pre class="language-text"><code># 这种模板需要使用两个下划线来取代单个下划线：

/generator/template/__variables.scss

# 调用 api.render('./template') 会在项目目录中渲染成为：

_variables.scss
</code></pre></div><h3 id="prompts"><a href="#prompts" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#prompts" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Prompts</h3> <h4 id="内建插件的对话"><a href="#内建插件的对话" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E5%86%85%E5%BB%BA%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 内建插件的对话</h4> <p>只有内建插件可以定制创建新项目时的初始化对话，且这些对话模块放置在 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/promptModules" target="_blank" rel="noopener noreferrer"><code>@vue/cli</code> 包的内部<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/promptModules" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>。</p> <p>一个对话模块应该导出一个函数，这个函数接收一个 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/PromptModuleAPI.js" target="_blank" rel="noopener noreferrer">PromptModuleAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/PromptModuleAPI.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实例。这些对话的底层使用 <a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一个特性对象应该是一个有效的 inquirer 选择对象</span>
  api<span class="token punctuation">.</span><span class="token function">injectFeature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Some great feature'</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token string">'my-feature'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// injectPrompt 期望接收一个有效的 inquirer 对话对象</span>
  api<span class="token punctuation">.</span><span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'someFlag'</span><span class="token punctuation">,</span>
    <span class="token comment">// 确认对话只在用户已经选取了特性的时候展示</span>
    <span class="token function-variable function">when</span><span class="token punctuation">:</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token string">'my-feature'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'Do you want to turn on flag foo?'</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'confirm'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 当所有的对话都完成之后，将你的插件注入到</span>
  <span class="token comment">// 即将传递给 Generator 的 options 中</span>
  api<span class="token punctuation">.</span><span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'my-feature'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'vue-cli-plugin-my-feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        someFlag<span class="token punctuation">:</span> answers<span class="token punctuation">.</span>someFlag
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="第三方插件的对话"><a href="#第三方插件的对话" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 第三方插件的对话</h4> <p>第三方插件通常会在一个项目创建完毕后被手动安装，且用户将会通过调用 <code>vue invoke</code> 来初始化这个插件。如果这个插件在其根目录包含一个 <code>prompts.js</code>，那么它将会用在该插件被初始化调用的时候。这个文件应该导出一个用于 Inquirer.js 的<a href="https://github.com/SBoudrias/Inquirer.js#question" target="_blank" rel="noopener noreferrer">问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/SBoudrias/Inquirer.js#question" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>的数组。这些被解析的答案对象会作为选项被传递给插件的 generator。</p> <p>或者，用户可以通过在命令行传递选项来跳过对话直接初始化插件，比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vue invoke my-plugin --mode awesome
</code></pre></div><h2 id="发布插件"><a href="#发布插件" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E5%8F%91%E5%B8%83%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 发布插件</h2> <p>为了让一个 CLI 插件能够被其它开发者使用，你必须遵循 <code>vue-cli-plugin-&lt;name&gt;</code> 的命名约定将其发布到 npm 上。插件遵循命名约定之后就可以：</p> <ul><li>被 <code>@vue/cli-service</code> 发现；</li> <li>被其它开发者搜索到；</li> <li>通过 <code>vue add &lt;name&gt;</code> 或 <code>vue invoke &lt;name&gt;</code> 安装下来。</li></ul> <h3 id="本地测试插件"><a href="#本地测试插件" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E6%8F%92%E4%BB%B6" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 本地测试插件</h3> <p>当你进行插件开发的时候，需要在本地对插件进行测试，你可以使用已有的 Vue CLI 项目或者新建一个项目来进行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vue create test-app
</code></pre></div><p>然后，在项目的根目录，使用下面的命令添加需要测试的本地插件：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev file:/full/path/to/your/plugin
vue invoke <span class="token operator">&lt;</span>your-plugin-name<span class="token operator">&gt;</span>
</code></pre></div><p>当对插件进行了修改之后，你需要重复上面的步骤来使变动生效</p> <h2 id="开发核心插件的注意事项"><a href="#开发核心插件的注意事项" aria-hidden="true" class="header-anchor">#</a> <a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html#%E5%BC%80%E5%8F%91%E6%A0%B8%E5%BF%83%E6%8F%92%E4%BB%B6%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener noreferrer">#<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开发核心插件的注意事项</h2> <p>注意</p> <p>这个章节只用于 <code>vuejs/vue-cli</code> 仓库内部的内建插件工作。</p> <p>一个带有为本仓库注入额外依赖的 generator 的插件 (比如 <code>chai</code> 会通过 <code>@vue/cli-plugin-unit-mocha/generator/index.js</code> 被注入) 应该将这些依赖列入其自身的 <code>devDependencies</code> 字段。这会确保：</p> <ol><li>这个包始终存在于该仓库的根 <code>node_modules</code> 中，因此我们不必在每次测试的时候重新安装它们。</li> <li><code>yarn.lock</code> 会保持其一致性，因此 CI 程序可以更好地利用缓存。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9374f4fe.js" defer></script><script src="/assets/js/3.6325cee0.js" defer></script><script src="/assets/js/2.3daf7506.js" defer></script><script src="/assets/js/9.78e37e51.js" defer></script>
  </body>
</html>
